# Snapshots Directory

Full HAR-extracted SPA snapshots, organized by date.

## Structure

```
snapshots/
├── 2026-01-21/
│   ├── full_spec.json      # Complete SPA specification
│   ├── endpoints.json      # Extracted API endpoints
│   └── metadata.json       # Snapshot metadata
├── 2026-01-22/
│   └── ...
└── README.md               # This file
```

## File Descriptions

### `full_spec.json`
Complete specification extracted from HAR file containing:
- JavaScript module sources (app + vendor)
- API endpoint catalog (REST + SSE)
- Module dependency graphs
- Import/export analysis
- Protocol version information

Generated by: `har_agent.py`

### `endpoints.json`
Focused extract of API endpoints including:
- Endpoint paths and methods
- Parameter schemas
- Category classification (REST, SSE, Auth, etc.)
- Usage frequency from HAR capture

Generated by: AST extraction from HAR analysis

### `metadata.json`
Snapshot metadata:
```json
{
  "date": "2026-01-21",
  "source": "capture.har",
  "endpoints_count": 96,
  "modules_count": 752,
  "protocol_version": "2.18",
  "capture_time": "2026-01-21T21:56:07Z"
}
```

## Usage

### Adding New Snapshot

```bash
# Create snapshot directory
DATE=$(date +%Y-%m-%d)
mkdir -p spa-assets/snapshots/$DATE

# Copy extracted files
cp perplexity_spa_full_spec.json spa-assets/snapshots/$DATE/full_spec.json
cp endpoints_ast_extracted_full.json spa-assets/snapshots/$DATE/endpoints.json

# Generate metadata
cat > spa-assets/snapshots/$DATE/metadata.json << EOF
{
  "date": "$DATE",
  "source": "$(basename *.har)",
  "endpoints_count": $(jq '.metadata.endpoints_rest_count' perplexity_spa_full_spec.json),
  "modules_count": $(jq '.metadata.js_modules_total' perplexity_spa_full_spec.json),
  "protocol_version": "2.18",
  "capture_time": "$(date -u +%Y-%m-%dT%H:%M:%SZ)"
}
EOF
```

### Querying Snapshots

```bash
# List all snapshots
ls -1 spa-assets/snapshots/

# Get endpoint count for a date
jq '.metadata.endpoints_rest_count' spa-assets/snapshots/2026-01-21/full_spec.json

# Find specific endpoint across versions
for dir in spa-assets/snapshots/*/; do
  echo "$(basename $dir):"
  jq '.endpoints.rest[] | select(contains("/rest/thread"))' "$dir/endpoints.json" | head -5
done
```

## Retention Policy

- **Keep all**: Major protocol version changes (e.g., 2.18 → 3.0)
- **Keep 10**: Most recent snapshots regardless of changes
- **Archive**: Snapshots older than 6 months to separate storage
- **Delete**: Duplicate snapshots with no differences

## Notes

- Snapshots are point-in-time captures, not continuous monitoring
- Each snapshot is independent and self-contained
- Use diffs to track changes between snapshots
- Large files (> 1 MB) should use Git LFS

---

**See also**: `/spa-assets/diffs/` for version comparisons
